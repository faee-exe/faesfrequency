<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>faesFrequency ‚Äî transmitting sound through the static</title>
  <meta name="description" content="faesFrequency is an independent digital radio stream broadcasting live through Icecast.">
  <link rel="icon" type="image/png" href="favicon.png" sizes="32x32">
  <link rel="apple-touch-icon" href="favicon.png">
  <meta property="og:title" content="faesFrequency">
  <meta property="og:description" content="transmitting sound through the static">
  <meta property="og:image" content="https://faee-exe.github.io/faestaste/logo.png">
  <meta property="og:url" content="https://faee-exe.github.io/faestaste/">
  <meta name="theme-color" content="#d6d6d2">
  <style>
    body {margin:0;font-family:monospace;background:#f7f7f5;color:#000;text-align:center;}
    header{background:#d6d6d2;height:220px;display:flex;align-items:center;justify-content:center;overflow:hidden;}
    .site-logo{width:min(55vw,480px);height:auto;object-fit:contain;transition:transform .3s ease;}
    .site-logo:hover{transform:scale(1.03);}
    @media(max-width:600px){header{height:160px}.site-logo{width:75vw}}
    .play-button{background:#000;border-radius:50%;width:130px;height:130px;display:flex;align-items:center;justify-content:center;margin:80px auto 35px;cursor:pointer;transition:transform .1s ease,background .2s ease;user-select:none}
    .play-button:active{transform:translateY(4px) scale(.96)}
    .play-button svg{width:50px;height:50px;fill:#fff}
    .controls{display:flex;justify-content:center;align-items:center;gap:14px;margin-top:20px;flex-wrap:wrap}
    #liveTag,.schedule-link{display:inline-flex;align-items:center;justify-content:center;height:48px;width:150px;font-size:.9em;font-weight:bold;text-transform:uppercase;letter-spacing:.05em;border:2px solid #000;transition:background .2s ease,color .2s ease;line-height:1;border-radius:4px}
    #liveTag{border:none;background:#999;color:#fff}
    .live{background:#ff4747;color:#fff}.offline{background:#999;color:#fff}.paused{background:#d6d6d2;color:#000}
    .schedule-link{color:#000;text-decoration:none;background:transparent}.schedule-link:hover{background:#000;color:#fff}
    .comments-section{max-width:700px;margin:80px auto 60px;padding:0 20px;text-align:left;display:none}
    .comments-section h2{text-align:center;text-transform:uppercase;font-size:1.4em;margin-bottom:12px}
    #userMeta{font-size:.9em;margin-bottom:10px;color:#333}
    #comments{background:#fff;border:2px solid #d6d6d2;padding:15px;border-radius:8px;min-height:100px;margin-bottom:15px;box-shadow:0 2px 6px rgba(0,0,0,.05);max-height:300px;overflow-y:auto}
    .comment{margin-bottom:10px;border-bottom:1px solid #eee;padding-bottom:8px}
    .comment strong{color:#444}.comment small{color:#777}
    .owner-name{color:#d4af37;font-weight:bold}
    .owner-badge{display:inline-block;margin-left:6px;font-size:.7em;padding:2px 6px;border:1px solid #d4af37;border-radius:4px;color:#d4af37}
    .comment-form{display:flex;flex-direction:column;gap:10px}
    .comment-form textarea,.comment-form button{font-family:monospace;font-size:1em;padding:10px;border:2px solid #000;border-radius:6px}
    .comment-form textarea{resize:vertical;height:60px}
    .comment-form button{background:#000;color:#fff;cursor:pointer;font-weight:bold;text-transform:uppercase}
    .comment-form button:hover{background:#333}
    .change-user-btn{background:transparent;border:2px solid #000;border-radius:6px;padding:6px 10px;font-family:monospace;font-size:.9em;cursor:pointer;transition:background .2s ease,color .2s ease;margin-bottom:10px}
    .change-user-btn:hover{background:#000;color:#fff}
    .how-section{max-width:700px;margin:100px auto 80px;padding:0 20px;text-align:left;line-height:1.6;color:#222}
    .how-section h2{text-align:center;text-transform:uppercase;font-size:1.4em;margin-bottom:30px;letter-spacing:.05em}
    .how-section p{background:#fff;border:2px solid #d6d6d2;padding:20px 25px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.05)}
    footer{margin-top:100px;font-size:.9em;color:#555;padding-bottom:30px}
    audio{display:none}
  </style>
</head>
<body>
  <header><img src="logo.png" alt="faesFrequency logo" class="site-logo"></header>
  <div class="play-button" id="playBtn">
    <svg id="iconPlay" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
    <svg id="iconPause" viewBox="0 0 24 24" style="display:none"><path d="M6 5h4v14H6zM14 5h4v14h-4z"/></svg>
  </div>
  <div class="controls">
    <div id="liveTag" class="offline"></div>
    <a href="schedule.html" class="schedule-link">Schedule</a>
  </div>

  <section class="comments-section" id="commentsSection">
    <h2>Comments</h2>
    <div id="userMeta">Posting as: <strong id="currentUser">Anonymous</strong></div>
    <button class="change-user-btn" id="changeUser">Change User</button>
    <div id="comments"></div>
    <form id="commentForm" class="comment-form">
      <textarea id="commentInput" placeholder="Write a comment..." required></textarea>
      <button type="submit">Post Comment</button>
    </form>
  </section>

  <section class="how-section">
    <h2>How Did You Do This?</h2>
    <p>
      First, I set up Icecast, which broadcasts audio from a DJ/radio tool called <strong>BUTT</strong>,
      to a URL starting with <code>http</code>. Then I took my <code>http</code> Icecast link through
      a program called <strong>Cloudflare</strong> to make it start with <code>https</code> ‚Äî because
      the website you‚Äôre reading this from is <code>https</code>, and <code>http</code> audio
      can‚Äôt be broadcasted through a secure site.<br><br>
      Then I spent 70 years and 70 days coding this website in HTML.
      (I‚Äôm joking ‚Äî I used ChatGPT, because all this work had me exhausted,
      and I couldn‚Äôt be bothered to code on top of all that üò≠üôè)
    </p>
  </section>

  <footer>Streaming live via Icecast + BUTT.</footer>
  <audio id="player" crossorigin="anonymous"></audio>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, set, serverTimestamp, get, remove } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

    const firebaseConfig = {
      apiKey:"AIzaSyCewcWr5ZkpzHWrOCxza0yHU38_Vqer9Vg",
      authDomain:"faesfrequency.firebaseapp.com",
      databaseURL:"https://faesfrequency-default-rtdb.firebaseio.com",
      projectId:"faesfrequency",
      storageBucket:"faesfrequency.firebasestorage.app",
      messagingSenderId:"686971139183",
      appId:"1:686971139183:web:05787cbd94e7d49cd7c99a"
    };

    const app=initializeApp(firebaseConfig);
    const db=getDatabase(app);
    const commentsRef=ref(db,"comments");

    const commentsDiv=document.getElementById("comments");
    const commentForm=document.getElementById("commentForm");
    const commentInput=document.getElementById("commentInput");
    const currentUserEl=document.getElementById("currentUser");
    const changeUserBtn=document.getElementById("changeUser");
    const commentsSection=document.getElementById("commentsSection");

    let username=localStorage.getItem("faes_username")||"";
    let userSetAt=parseInt(localStorage.getItem("faes_userSetAt")||"0",10);
    const WEEK_MS=7*24*60*60*1000;

    function updateUsernameDisplay(){currentUserEl.textContent=username||"Anonymous";}
    function canChangeUser(){return Date.now()-userSetAt>WEEK_MS;}
    function updateChangeUserBtn(){
      if(canChangeUser()){
        changeUserBtn.disabled=false;
        changeUserBtn.textContent="Change User";
      }else{
        const nextAllowed=new Date(userSetAt+WEEK_MS);
        const diff=Math.ceil((nextAllowed-Date.now())/(1000*60*60*24));
        changeUserBtn.disabled=true;
        changeUserBtn.textContent=`CHANGE USER IN ${diff} DAY${diff===1?"":"S"}`;
      }
    }

    changeUserBtn.addEventListener("click",async()=>{
      if(!canChangeUser())return;
      const newUser=prompt("Enter a new username:");
      if(!newUser)return;
      const cleanUser=newUser.trim();
      const currentUser=localStorage.getItem("faes_username");
      const snapshot=await get(commentsRef);
      let exists=false;
      if(snapshot.exists()){
        const data=snapshot.val();
        exists=Object.values(data).some(c=>c.user===cleanUser&&cleanUser!=="faee"&&currentUser!==cleanUser);
      }
      if(exists){alert("That username is already taken. Please choose another.");return;}
      username=cleanUser;
      localStorage.setItem("faes_username",username);
      localStorage.setItem("faes_userSetAt",Date.now().toString());
      userSetAt=Date.now();
      updateUsernameDisplay();
      updateChangeUserBtn();
      alert("Username updated! You can change it again in 7 days.");
    });

    updateUsernameDisplay();
    updateChangeUserBtn();
    setInterval(updateChangeUserBtn,3600000);

    onValue(commentsRef,(snapshot)=>{
      const data=snapshot.val();
      commentsDiv.innerHTML="";
      if(data){
        const comments=Object.values(data).map(c=>{
          const t=typeof c.time==="number"?c.time:Date.parse(c.time);
          return {...c,_t:isNaN(t)?0:t};
        }).sort((a,b)=>a._t-b._t);
        comments.forEach(c=>{
          const when=c._t?new Date(c._t).toUTCString():"time pending‚Ä¶";
          const isOwner=c.user==="faee";
          const userHTML=isOwner
            ?`<strong class="owner-name">${sanitize(c.user)}</strong><span class="owner-badge">{ OWNER }</span>`
            :`<strong>${sanitize(c.user)}</strong>`;
          const div=document.createElement("div");
          div.className="comment";
          div.innerHTML=`${userHTML}<small> ‚Ä¢ ${when}</small><div>${sanitize(c.text)}</div>`;
          commentsDiv.appendChild(div);
        });
        commentsDiv.scrollTo({top:commentsDiv.scrollHeight,behavior:"smooth"});
      }else{
        commentsDiv.innerHTML="<p>No comments yet ‚Äî be the first!</p>";
      }
    });

    commentForm.addEventListener("submit",e=>{
      e.preventDefault();
      const text=commentInput.value.trim();
      if(!text)return;
      if(!username){
        username=prompt("Enter a username:")||"Anonymous";
        localStorage.setItem("faes_username",username);
        localStorage.setItem("faes_userSetAt",Date.now().toString());
        userSetAt=Date.now();
        updateUsernameDisplay();
        updateChangeUserBtn();
      }
      const newRef=push(commentsRef);
      set(newRef,{user:username,text,time:serverTimestamp()});
      commentInput.value="";
      setTimeout(()=>commentsDiv.scrollTo({top:commentsDiv.scrollHeight,behavior:"smooth"}),300);
    });

    function sanitize(str){
      return str.replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[m]));
    }

    const STREAM_URL="https://interference-situation-traveling-rice.trycloudflare.com/stream";
    const audio=document.getElementById("player");
    const playBtn=document.getElementById("playBtn");
    const iconPlay=document.getElementById("iconPlay");
    const iconPause=document.getElementById("iconPause");
    const liveTag=document.getElementById("liveTag");
    let playing=false,isLive=false;
    liveTag.textContent="";audio.src=STREAM_URL;

    playBtn.addEventListener("click",async()=>{
      if(playing){
        audio.pause();playing=false;
        playBtn.style.background="#000";iconPlay.style.display="block";iconPause.style.display="none";
        liveTag.textContent="Paused";liveTag.className="paused";commentsSection.style.display="none";return;
      }
      liveTag.textContent="Connecting";liveTag.className="paused";
      try{
        await audio.play();playing=true;isLive=true;
        playBtn.style.background="#d6d6d2";iconPlay.style.display="none";iconPause.style.display="block";
        liveTag.textContent="Live Now";liveTag.className="live";commentsSection.style.display="block";
      }catch(e){
        playing=false;isLive=false;playBtn.style.background="#000";
        iconPlay.style.display="block";iconPause.style.display="none";
        liveTag.textContent="Offline";liveTag.className="offline";commentsSection.style.display="none";
      }
    });

    audio.addEventListener("ended",async()=>{
      liveTag.textContent="Offline";
      liveTag.className="offline";
      commentsSection.style.display="none";
      try{await remove(commentsRef);}catch{}
      isLive=false;
      playing=false;
      playBtn.style.background="#000";
      iconPlay.style.display="block";
      iconPause.style.display="none";
    });

    audio.addEventListener("error",async()=>{
      liveTag.textContent="Offline";
      liveTag.className="offline";
      commentsSection.style.display="none";
      try{await remove(commentsRef);}catch{}
      isLive=false;
      playing=false;
      playBtn.style.background="#000";
      iconPlay.style.display="block";
      iconPause.style.display="none";
    });
  </script>
</body>
</html>
